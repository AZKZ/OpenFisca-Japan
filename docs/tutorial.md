# OpenFisca-Japanのチュートリアル

架空の「3の倍数給付金💴」の実装を通して、OpenFisca-Japanの開発方法について理解を深めましょう！

## 目的

- 様々な方にOpenFisca-Japanの開発に参加していただけるように、開発を始める際のハードルを下げるため

## 前提

- 開発環境構築が完了していること
- このチュートリアルの対象はOpenFiscaフレームワークを使用しているバックエンド（Python）のみ

## 架空の制度「3の倍数給付金💴」

- 年齢が3の倍数の世帯員の1人につき、年間10万円を給付する架空の制度
    - 小学校3年生、小学校6年生、中学校3年生、高校3年生はボーナスタイムとして追加で年間3万円を給付する

## STEP1：テストデータを作成する

制度を実装する際には、まずテストデータを作成することをおすすめします。テストデータを作成する過程において制度に関する理解が深まることにより、実装がスムーズに進められると思うためです。

テストデータを作成するには下記の作業を実施します。

1. テストパターンのCSVを作成する
2. CSVからOpenFiscaのテストデータ（ymlファイル）を生成するスクリプトを作成する
3. スクリプトを実行して、OpenFiscaのテストデータを生成する

<aside>
💡 ymlファイルよりもCSVファイルのほうがテストケースの網羅性を把握しやすいため、あえてCSVファイルを作成しています。

</aside>

### 1. テストパターンのCSVを作成する

テストパターンのCSVファイルは`make_tests/テストパターン`の配下に格納します。

下記の内容で`チュートリアル制度.csv`を作成して、上記のディレクトリに格納してください。

なお、テストパターンのCSVファイルは制度によって異なります。他のCSVファイルの内容も参考までに確認することをおすすめします。

```
テストID,対象支援制度,自分_年齢,配偶者_年齢,親1_年齢,親2_年齢,第1子_年齢,第1子_学年,第2子_年齢,第2子_学年,給付金額,テストケース説明
1,3の倍数給付金,45,44,74,74,19,,2,,"100,000",自分のみが給付対象の場合
2,3の倍数給付金,45,,,,,,,,"100,000",自分のみが給付対象で他の世帯員がいない場合
3,3の倍数給付金,44,45,74,74,19,,2,,"100,000",配偶者のみが給付対象の場合
4,3の倍数給付金,44,44,75,74,19,,2,,"100,000",親1のみが給付対象の場合
5,3の倍数給付金,44,44,74,75,19,,2,,"100,000",親2のみが給付対象の場合
6,3の倍数給付金,44,44,74,74,21,,2,,"100,000",第1子のみが給付対象の場合
7,3の倍数給付金,44,44,74,74,19,,3,,"100,000",第2子のみが給付対象の場合
8,3の倍数給付金,44,44,74,74,,小3,2,,"130,000",第1子のみが給付対象でボーナス対象（小学校3年生）の場合
9,3の倍数給付金,44,44,74,74,,小6,2,,"130,000",第1子のみが給付対象でボーナス対象（小学校6年生）の場合
10,3の倍数給付金,44,44,74,74,,中3,2,,"130,000",第1子のみが給付対象でボーナス対象（中学校3年生）の場合
11,3の倍数給付金,44,44,74,74,,高3,2,,"130,000",第1子のみが給付対象でボーナス対象（高校3年生）の場合
12,3の倍数給付金,45,45,75,75,21,,3,,"600,000",全員が給付対象である場合
13,3の倍数給付金,45,45,75,75,,高3,,小3,"660,000",全員が給付対象で子供が全員ボーナス対象の場合
14,3の倍数給付金,44,44,74,74,19,,2,,0,給付対象の世帯員がいない場合
```

### 2. CSVからOpenFiscaのテストデータ（ymlファイル）を生成するスクリプトを作成する

ymlファイルのテストデータを生成するPythonスクリプトは`make_tests/mylib/mymodule/`に格納します。

下記の内容で`tutorial_seido.py`を作成して、上記のディレクトリに格納してください。

```python

```

### 3. スクリプトを実行して、OpenFiscaのテストデータを生成する

テストデータ生成用のPythonスクリプトは`make_tests/generate.sh`から実行されます。

まずは前述の手順で作成した`tutorial_seido.py`を実行するためのコマンドを上記のshファイルに追記してください。

```bash
python3 make_tests.py -i テストパターン/チュートリアル制度.csv -c tutorial_seido -o チュートリアル制度テスト
```

その後、shファイルを実行することで`openfisca_japan/tests/generated`フォルダにテストデータのymlファイルが生成されます。

```bash
bash make_tests/generate.sh
```

## STEP2：”年齢が3の倍数の世帯員の1人につき、年間10万円を給付する”を実装する

### 1. XXX

### 2. XXX

### 3. テストを実行する

## STEP3：”小学校3年生、小学校6年生、中学校3年生、高校3年生”に対するロジックを追加する

### 1. XXX

### 2. XXX

### 3. テストを実行する

## STEP4：Web APIとしてデータを取得してみる